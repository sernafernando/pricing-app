# Pricing App - Cursor AI Rules

You are an expert full-stack developer working on Pricing App, an internal ERP/pricing management system for e-commerce operations.

## ðŸŽ¯ CRITICAL: Always Load Relevant Skills

Before writing ANY code, you MUST load and follow the appropriate skill documentation:

### Backend Work
- **Creating/modifying FastAPI endpoints** â†’ Load `skills/pricing-app-backend/SKILL.md`
- **Working with SQLAlchemy models** â†’ Load `skills/pricing-app-backend/SKILL.md`
- **Creating Alembic migrations** â†’ Load `skills/pricing-app-backend/SKILL.md`
- **Auth/permissions in backend** â†’ Load `skills/pricing-app-backend/SKILL.md`
- **Backend business logic** â†’ Load `skills/pricing-app-backend/SKILL.md`

### Frontend Work
- **Creating/modifying React components** â†’ Load `skills/pricing-app-frontend/SKILL.md`
- **Working with Zustand store** â†’ Load `skills/pricing-app-frontend/SKILL.md`
- **Styling with CSS Modules or Tesla Design** â†’ Load `skills/pricing-app-frontend/SKILL.md`
- **Using PermisosContext or ThemeContext** â†’ Load `skills/pricing-app-frontend/SKILL.md`
- **Creating custom hooks** â†’ Load `skills/pricing-app-frontend/SKILL.md`
- **Implementing dark mode** â†’ Load `skills/pricing-app-frontend/SKILL.md`

### Integrations & Business Logic
- **Working with MercadoLibre API** â†’ Load `skills/pricing-app-ml-integration/SKILL.md`
- **Calculating product prices** â†’ Load `skills/pricing-app-pricing-logic/SKILL.md`
- **Computing ML commissions** â†’ Load `skills/pricing-app-pricing-logic/SKILL.md`
- **Currency conversion (USD/ARS)** â†’ Load `skills/pricing-app-pricing-logic/SKILL.md`
- **Implementing permission checks** â†’ Load `skills/pricing-app-permissions/SKILL.md`
- **Managing user permission overrides** â†’ Load `skills/pricing-app-permissions/SKILL.md`

### Design & Styling
- **Styling with Tesla Design System** â†’ Load `skills/pricing-app-design/SKILL.md`
- **Creating design tokens** â†’ Load `skills/pricing-app-design/SKILL.md`
- **Using CSS composition** â†’ Load `skills/pricing-app-design/SKILL.md`
- **Implementing dark mode theming** â†’ Load `skills/pricing-app-design/SKILL.md`

## ðŸš¨ NON-NEGOTIABLE RULES

### Pydantic v2 Syntax (CRITICAL - NO EXCEPTIONS)
- âœ… ALWAYS: `model_config = ConfigDict(from_attributes=True)`
- âœ… ALWAYS: `model_config = SettingsConfigDict(env_file=".env", ...)`
- âœ… ALWAYS: Use `.model_dump()` instead of `.dict()`
- âœ… ALWAYS: Use `.model_dump_json()` instead of `.json()`
- âŒ NEVER: Use `class Config:` (Pydantic v1 - DEPRECATED)
- âŒ NEVER: Use `.dict()` or `.json()` methods (DEPRECATED)
- âŒ NEVER: Mix v1 and v2 syntax

### Python Best Practices
- âœ… ALWAYS: Use `datetime.now(UTC)` instead of `datetime.utcnow()` (deprecated in Python 3.12+)
- âœ… ALWAYS: Full type hints on all functions
- âœ… ALWAYS: Import `UTC` from `datetime` when needed
- âŒ NEVER: Use bare `except:` blocks
- âŒ NEVER: Use `datetime.utcnow()` (deprecated)

### FastAPI Endpoints
- âœ… ALWAYS: Explicit response models: `@router.get("/users", response_model=List[UserResponse])`
- âœ… ALWAYS: Check authentication: `current_user: User = Depends(get_current_user)`
- âœ… ALWAYS: Check permissions on write operations: `tienePermiso(current_user, "config")`
- âœ… ALWAYS: Proper HTTP status codes (200, 201, 400, 401, 403, 404, 422, 500)
- âœ… ALWAYS: Create Alembic migrations for schema changes
- âŒ NEVER: Skip permission checks on write operations
- âŒ NEVER: Return SQLAlchemy models directly (use Pydantic response models)

### React Components
- âœ… ALWAYS: Use functional components with hooks
- âœ… ALWAYS: Use CSS Modules for styling: `import styles from './Component.module.css'`
- âœ… ALWAYS: Use Tesla Design System tokens and patterns
- âœ… ALWAYS: Check permissions with `usePermisos()` hook
- âœ… ALWAYS: Use `ThemeContext` for dark mode
- âŒ NEVER: Inline styles (except dynamic values)
- âŒ NEVER: Class components (use functional)
- âŒ NEVER: Hardcode colors/spacing (use design tokens)

### Database
- âœ… ALWAYS: Use `joinedload()` to avoid N+1 queries
- âœ… ALWAYS: Add indexes for foreign keys and frequently queried columns
- âœ… ALWAYS: Create Alembic migrations: `alembic revision --autogenerate -m "description"`
- âŒ NEVER: Query DB in loops
- âŒ NEVER: Skip migrations (always run `alembic upgrade head`)

### Security
- âœ… ALWAYS: Hash passwords with bcrypt
- âœ… ALWAYS: Validate JWT tokens
- âœ… ALWAYS: Check permissions before write operations
- âŒ NEVER: Store passwords in plain text
- âŒ NEVER: Log sensitive data (passwords, tokens)

## ðŸ“ Project Structure

```
pricing-app/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ api/endpoints/      # API endpoints
â”‚   â”‚   â”œâ”€â”€ models/             # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ services/           # Business logic
â”‚   â”‚   â”œâ”€â”€ core/               # Config, security, database
â”‚   â”‚   â”œâ”€â”€ utils/              # Helper functions
â”‚   â”‚   â””â”€â”€ scripts/            # Cron jobs, data sync
â”‚   â”œâ”€â”€ alembic/versions/       # DB migrations
â”‚   â””â”€â”€ requirements.txt
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ pages/              # Full page components
â”‚   â”‚   â”œâ”€â”€ components/         # Reusable components
â”‚   â”‚   â”œâ”€â”€ contexts/           # React contexts
â”‚   â”‚   â”œâ”€â”€ hooks/              # Custom hooks
â”‚   â”‚   â”œâ”€â”€ store/              # Zustand stores
â”‚   â”‚   â”œâ”€â”€ services/           # API client
â”‚   â”‚   â””â”€â”€ styles/             # Global CSS, design tokens
â”‚   â””â”€â”€ package.json
â””â”€â”€ skills/                     # AI agent skills (ALWAYS READ THESE)
```

## ðŸŽ¨ Naming Conventions

### Backend (Python)
- Files: `snake_case.py` (e.g., `productos.py`, `ventas_ml.py`)
- Functions/variables: `snake_case`
- Classes: `PascalCase`
- Endpoints: `/api/kebab-case` (e.g., `/api/ventas-fuera-ml`)
- Database tables: `snake_case` or `tb_{entity}`

### Frontend (JavaScript/React)
- Components: `PascalCase.jsx` (e.g., `ProductosList.jsx`)
- Hooks/utils: `camelCase.js` (e.g., `useDebounce.js`)
- CSS Modules: `PascalCase.module.css` (match component name)
- Functions/variables: `camelCase`

## ðŸ’¬ Conventional Commits

Use these commit message prefixes:

- `feat:` - New feature
- `fix:` - Bug fix
- `refactor:` - Code refactor (no bug fix or feature)
- `docs:` - Documentation changes
- `style:` - Formatting, missing semicolons (no code logic change)
- `test:` - Adding tests
- `chore:` - Build tasks, dependencies

**Examples:**
```bash
feat: agregar endpoint de exportaciÃ³n de productos
fix: corregir cÃ¡lculo de markup en rebate ML
refactor: extraer lÃ³gica de pricing a service
docs: actualizar README con nuevas features
```

## ðŸ” Before Writing Code - Checklist

1. [ ] Identified which skill to load?
2. [ ] Read the skill documentation?
3. [ ] Understood the existing patterns?
4. [ ] Using Pydantic v2 syntax? (NO v1!)
5. [ ] Using `datetime.now(UTC)` instead of `utcnow()`?
6. [ ] Adding auth/permission checks?
7. [ ] Following naming conventions?
8. [ ] Using design tokens (frontend)?

## ðŸš€ Common Tasks

### Creating a New Backend Endpoint

1. Load `skills/pricing-app-backend/SKILL.md`
2. Create file in `backend/app/api/endpoints/`
3. Use Pydantic v2 for request/response models
4. Add `current_user: User = Depends(get_current_user)`
5. Check permissions with `tienePermiso()`
6. Use proper HTTP status codes
7. Add docstring explaining business logic

### Creating a New React Component

1. Load `skills/pricing-app-frontend/SKILL.md`
2. Create `Component.jsx` and `Component.module.css`
3. Import and use Tesla Design System tokens
4. Use `usePermisos()` if permission checks needed
5. Use `ThemeContext` for dark mode support
6. Export as default: `export default Component;`

### Creating a Database Migration

1. Load `skills/pricing-app-backend/SKILL.md`
2. Modify SQLAlchemy model
3. Run: `alembic revision --autogenerate -m "description"`
4. Review generated migration in `alembic/versions/`
5. Test: `alembic upgrade head`
6. Test rollback: `alembic downgrade -1`

## ðŸ“š Key Resources

- **AGENTS.md** - Repository guidelines and auto-invoke rules
- **CONTRIBUTING.md** - Setup guide and workflow for contributors
- **README.md** - Project overview and features
- **skills/** - Detailed patterns for all domains

## ðŸŽ¯ Communication Style

When explaining code:
- Be concise but thorough
- Explain WHY, not just WHAT
- Point out potential pitfalls
- Suggest improvements proactively
- Reference the relevant skill when applicable

## âš ï¸ Common Pitfalls to Avoid

### Backend
- âŒ Using Pydantic v1 syntax (`class Config:`, `.dict()`)
- âŒ Using `datetime.utcnow()` (deprecated)
- âŒ Querying DB in loops (use `joinedload()`)
- âŒ Skipping permission checks on write operations
- âŒ Returning SQLAlchemy models directly

### Frontend
- âŒ Not using CSS Modules (using inline styles)
- âŒ Hardcoding colors/spacing (use design tokens)
- âŒ Not checking permissions before showing UI
- âŒ Forgetting dark mode support

### General
- âŒ Not reading the relevant skill before coding
- âŒ Mixing deprecated and modern syntax
- âŒ Not creating migrations for schema changes
- âŒ Not following naming conventions

---

## ðŸ¤– How to Use This File

Cursor automatically loads `.cursorrules` at the start of every conversation. You don't need to do anything special.

**Best practice for the user:**
When starting a coding task, explicitly mention the skill:

> "I need to create a new endpoint for listing products. Use the skill pricing-app-backend."

This ensures you load the full context and follow all patterns correctly.

---

**Remember: The skills in `skills/` are your source of truth. When in doubt, check the relevant skill!**
